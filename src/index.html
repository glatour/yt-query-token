<html>

<head>
  <link rel="stylesheet" href="query.css">
  <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/glacial-indifference" type="text/css"/>
</head>

<body>
    <div ng-app="app" ng-controller="ctrl">
      <query tokens="myTokens"></query>

      <span ng-repeat="token in tokens">
          <span style="font-weigth: bold;">{{::token.key}}</span>
          <span style="font-weigth: bold;">{{::token.value}}</span>
      </span>

    </div>

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/bacon/dist/Bacon.js"></script>
    <script src="/bower_components/angular/angular.js"></script>
    <script src="/bower_components/angular-bacon/dist/angular-bacon.js"></script>
    <script>
    angular.module('app', ["angular-bacon"])
        .directive('focusMe', function($timeout, $parse) {
          return {
            link: function(scope, element, attrs) {
              var model = $parse(attrs.focusMe);
              scope.$watch(model, function(value) {
                if(value === true) {
                  $timeout(function() {
                    element[0].focus();
                  });
                }
              });
              element.bind('blur', function() {
                 scope.$apply(model.assign(scope, false));
              });
            }
          };
        })
        .
directive('contenteditable', ['$sce', function($sce) {
  return {
    restrict: 'A',
    require: '?ngModel',
    link: function(scope, element, attrs, ngModel) {
      if (!ngModel) return;
      ngModel.$render = function() {
        element.html($sce.trustAsHtml(ngModel.$viewValue || ''));
      };
      element.on('blur keyup change', function() {
        scope.$evalAsync(read);
      });
      read();
      function read() {
        var html = element.html();
        if ( attrs.stripBr && html == '<br>' ) {
          html = '';
        }
        ngModel.$setViewValue(html);
      }
    }
  };
}])
        .controller('ctrl', function($scope) {
            $scope.$watchCollection('myTokens', function (newValue) {
              console.log(newValue);
            })
        })
        .directive('instruction', function() {
            return {
                restrict: 'A',
                link: function(scope, element, attrs) {}
            }
        })
    </script>
    <script src="query.js"></script>
    <script src="token.js"></script>
</body>

</html>
